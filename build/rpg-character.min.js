!function(a,b){b.rpgc=a;var c,d,e=function(){};return function(){var a,b,f,g,h,i="~",j=".";return a=Function[i]=Function[i]||function(b){return a[b]||(a[b]={}),a[b]},g=a("c"),b=a("d"),f=a("p"),h=function(a){if(!b[a]){var c=arguments,d=c[1];"function"==typeof d?b[a]=d():(g[a]=c[2],g[a][j]=d)}},c=d=function(){h.apply(null,arguments)},resolve=function(a,c){f[a]=!0;var d,e,h,i=c[j],k=[];if(i)for(e=i.length,d=0;d<e;d++)h=i[d],g[h]&&(f.hasOwnProperty(h)||resolve(h,g[h]),resolve(h,g[h]),delete g[h]);if(!b.hasOwnProperty(a)){for(d=0;d<e;d++)h=i[d],k.push(b.hasOwnProperty(h)&&b[h]);b[a]=c.apply(null,k)}delete f[a]},e=function(){for(var a in g)resolve(a,g[a])},c}(),c("character",["dispatcher","whichAnimationEvent"],function(b,c){function d(a,c,d,g,h){function i(a){switch(a){case s.up:case s.down:case s.left:case s.right:return!0;default:return!1}}function j(){for(var a=0;a<p.length;a+=1)if(!i(p[a]))return!0;return!1}function k(){if(!m){for(var a=0,b=j(),c=0;c<p.length;c+=1){var d=p[c],e=!i(d);if(a+=e?0:1,b||1!==a){if(e){a=0,n.setAction(q[d]);break}}else d===s.right?n.move(h,0):d===s.left?n.move(-h,0):d===s.up?n.move(0,-h):d===s.down&&n.move(0,h)}return a&&!n.el.classList.contains("walk")?n.el.classList.add("walk"):!a&&n.el.classList.contains("walk")&&n.el.classList.remove("walk"),n}}var l,m,n=this,o={},p=[],q={},r={},s={up:g[0],right:g[1],down:g[2],left:g[3]},t={};for(var u in s)s.hasOwnProperty(u)&&(t[s[u]]=u);var v=function(){};n.x=c||0,n.y=d||0,n.el=document.createElement("div"),n.el.classList.add("character"),n.el.classList.add(a),l=document.createElement("div"),l.classList.add("body"),n.el.appendChild(l),n.handleKeyDown=function(a){if(t[a]||q[a])return p.indexOf(a)===-1&&p.push(a),n},n.handleKeyUp=function(a){if(t[a]||q[a]){var b=p.indexOf(a);return b!==-1&&p.splice(b,1),n}},n.move=function(a,b){function c(a){a&&e.classList.contains(a)&&e.classList.remove(a)}function d(a){n.dir!==a&&(c(n.dir),e.classList.add(a),n.dir=a)}var e=n.el;return n.x+=a,n.y+=b,d(a>0?"right":a<0?"left":b>0?"down":"up"),n},n.addAction=function(a,b,c){return q[b]=a,c&&(r[a]=c),n},n.getAction=function(){return m},n.setAction=function(a,b){m&&m.end();var c;return m={name:a,end:function(){clearTimeout(c),l.removeEventListener(f,m.end),b&&b(m),m.end=v,n.el.classList.remove("action"),n.el.classList.remove(a),n.dispatch(e.ACTION_END,m),m=null,r[a]&&n.el.classList.add(r[a])}},l.addEventListener(f,m.end),n.el.classList.add("action"),n.el.classList.add(a),n.dispatch(e.ACTION_START,m),n},n.addAccessory=function(a){if(!o[a]){var b=document.createElement("div");b.className="accessory "+a,n.el.appendChild(b),o[a]=b}return n},n.removeAccessory=function(a){return o[a]&&(n.el.removeChild(o[a]),delete o[a]),n},n.render=function(){return k(),n},b(n)}var e={ACTION_START:"action-start",ACTION_END:"action-end"},f=c();a.events=e,a.create=function(a,b,c,e,f){return new d(a,b,c,e,f)}}),c("dispatcher",["apply","isFunction","dispatcherEvent"],function(a,b,c){function d(a){if(!a)throw Error("event cannot be undefined")}var e=function(e,f,g){function h(a,b){var c=r[a];if(c)for(var d=0;d<c.length;d+=1)if(c[d].cb===b)return d;return-1}function i(a,b){d(a);var c=h(a,b),e=r[a];c!==-1&&e.splice(c,1)}function j(a,c,e){if(b(c))return d(a),r[a]=r[a]||[],r[a].push({cb:c,priority:void 0!==e?e:10}),r[a].sort(l),function(){i(a,c)}}function k(c,g,h){function k(){i(c,k),a(g,f||e,arguments)}if(b(g))return d(c),j(c,k,h)}function l(a,b){return a.priority-b.priority}function m(a,b,c){c[b]=a.cb}function n(a,b){d(a);var c,e="*";return a||b?(c=[],r[e]&&(c=r[e].concat(c)),r[a]&&(c=r[a].concat(c)),c.map(m),c):r}function o(){r={}}function p(b,c){return b&&a(b,e,c)}function q(a){d(a);var b,e=n(a,!0),f=e.length,a="object"==typeof a?a:new c(a);if(f)for(arguments[0]=a,b=0;b<f;b+=1)a.immediatePropagationStopped||p(e[b],arguments);return a}if(e&&e.on&&e.on.dispatcher)return e;e=e||{};var r={};return j.dispatcher=!0,f&&g?(e.on=f[g.on]&&f[g.on].bind(f),e.off=f[g.off]&&f[g.off].bind(f),e.once=f[g.once]&&f[g.once].bind(f),e.dispatch=e.fire=f[g.dispatch].bind(f)):(e.on=j,e.off=i,e.once=k,e.dispatch=e.fire=q),e.getListeners=n,e.removeAllListeners=o,e};return e}),c("apply",["isFunction"],function(a){return function(b,c,d){if(a(b)){switch(d=d||[],d.length){case 0:return b.call(c);case 1:return b.call(c,d[0]);case 2:return b.call(c,d[0],d[1]);case 3:return b.call(c,d[0],d[1],d[2]);case 4:return b.call(c,d[0],d[1],d[2],d[3]);case 5:return b.call(c,d[0],d[1],d[2],d[3],d[4]);case 6:return b.call(c,d[0],d[1],d[2],d[3],d[4],d[5])}return b.apply(c,d)}}}),c("isFunction",function(){var a=function(a){return"function"==typeof a};return a}),c("dispatcherEvent",function(){function a(a){this.type=a,this.defaultPrevented=!1,this.propagationStopped=!1,this.immediatePropagationStopped=!1}return a.prototype.preventDefault=function(){this.defaultPrevented=!0},a.prototype.stopPropagation=function(){this.propagationStopped=!0},a.prototype.stopImmediatePropagation=function(){this.immediatePropagationStopped=!0},a.prototype.toString=function(){return this.type},a}),c("whichAnimationEvent",function(){function a(){var a,b=document.createElement("fakeelement"),c={animation:"animationend",OAnimation:"oAnimationEnd",MozAnimation:"animationend",WebkitAnimation:"webkitAnimationEnd"};for(a in c)if(void 0!==b.style[a])return c[a]}return a}),e(),b.rpgc}(this.rpgc||{},function(){return this}());
//# sourceMappingURL=rpg-character.min.js.map